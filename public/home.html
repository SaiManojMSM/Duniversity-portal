<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home | DSATM Student Portal</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .background {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-image: url('images/img1.jpg');


      background-size: 110%;
      background-repeat: no-repeat;
      background-position: center;
      z-index: -1;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 20px; /* smaller padding */
      background-color: #006994;
      color: white;
      position: relative;
      height: 65px; /* smaller height */
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-left img {
      width: 80px; /* increased size */
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    header h1 {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 26px;
      margin: 0;
      text-align: center;
    }

    .menu-toggle {
      font-size: 28px;
      cursor: pointer;
    }

    nav {
      display: none;
      background-color: #006994;
      padding: 10px;
      position: absolute;
      top: 65px; /* match new header height */
      right: 20px;
      border-radius: 8px;
    }

    nav.show {
      display: block;
    }

    nav a {
      display: block;
      padding: 8px;
      color: white;
      text-decoration: none;
    }

    nav a:hover {
      background-color: #004d6d;
      border-radius: 4px;
    }

    .welcome {
      text-align: center;
      color: black;
      background-color: rgba(255, 255, 255, 0.85);
      max-width: 700px;
      margin: 120px auto;
      padding: 35px 25px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .welcome h2 {
      margin-bottom: 15px;
    }

    footer {
      text-align: center;
      color: white;
      position: fixed;
      bottom: 10px;
      width: 100%;
    }

    /* Enhanced Chatbot Styles */
    .chatbot-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .chatbot-box {
      display: none;
      width: 350px;
      max-height: 80vh;
      height: auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      overflow: visible;
      animation: slideUp 0.3s ease-out;
      margin-bottom: 10px;
    }
    
    .chatbot-box.open {
      display: flex;
      flex-direction: column;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .chatbot-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chatbot-title {
      display: flex;
      align-items: center;
      gap: 12px;
      color: white;
    }

    .bot-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(45deg, #ff6b6b, #ffd93d);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .chatbot-title h4 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .status-indicator {
      font-size: 12px;
      color: #4ade80;
      font-weight: 500;
    }

    .close-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .chat-messages {
      height: 320px;
      overflow-y: auto;
      padding: 20px;
      background: white;
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 #f1f5f9;
    }

    .chat-messages::-webkit-scrollbar {
      width: 4px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 2px;
    }

    .bot-message, .user-message {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 15px;
      animation: messageSlide 0.3s ease-out;
    }

    @keyframes messageSlide {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .user-message {
      flex-direction: row-reverse;
    }

    .bot-avatar-small {
      width: 30px;
      height: 30px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .user-avatar {
      width: 30px;
      height: 30px;
      background: linear-gradient(45deg, #06b6d4, #3b82f6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .message-content {
      background: #f8fafc;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 250px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    .user-message .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .message-content p {
      margin: 0 0 8px 0;
      font-size: 14px;
      line-height: 1.4;
    }

    .message-content ul {
      margin: 8px 0;
      padding-left: 16px;
    }

    .message-content li {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 20px;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
      background: #f8fafc;
      padding: 12px 16px;
      border-radius: 18px;
    }

    .typing-dots span {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #94a3b8;
      animation: typing 1.5s infinite;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    .chat-input-container {
      display: flex;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e2e8f0;
      gap: 10px;
    }

    #chat-input {
      flex: 1;
      border: 2px solid #e2e8f0;
      border-radius: 25px;
      padding: 12px 16px;
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }

    #chat-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #send-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 16px;
    }

    #send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .chatbot-toggle {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      position: relative;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }

    .chatbot-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5);
    }

    .chat-icon {
      font-size: 28px;
      color: white;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      animation: pulse 2s infinite;
    }

    /* Chat Controls */
    .chat-controls {
      padding: 10px 20px;
      background: white;
      border-top: 1px solid #f1f5f9;
    }

    .control-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .control-btn {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      color: #475569;
    }

    .control-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-1px);
    }

    /* Quick Options */
    .quick-options {
      padding: 15px 20px;
      background: #f8fafc;
      border-top: 1px solid #e2e8f0;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .quick-option-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .quick-btn {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-align: left;
      font-size: 12px;
      color: #374151;
    }

    .quick-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .quick-number {
      background: #667eea;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
      flex-shrink: 0;
    }

    .quick-btn:hover .quick-number {
      background: white;
      color: #667eea;
    }

    .quick-text {
      font-weight: 500;
    }

    /* History Modal */
    .history-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .history-content {
      background: white;
      border-radius: 20px;
      padding: 20px;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e2e8f0;
    }

    .history-close {
      background: #f1f5f9;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 16px;
    }

    .history-item {
      margin-bottom: 15px;
      padding: 10px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .history-timestamp {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 5px;
    }

    .history-messages {
      font-size: 13px;
    }

    /* Mobile Responsive Styles */
    @media screen and (max-width: 600px) {
      header {
        flex-direction: column;
        height: auto;
        padding: 15px;
      }

      header h1 {
        position: static;
        transform: none;
        text-align: center;
        font-size: 20px;
        margin-top: 10px;
      }

      .header-left img {
        width: 70px;
      }

      .welcome {
        margin: 80px 15px;
        padding: 25px 15px;
        font-size: 15px;
      }

      .chatbot-container {
        bottom: 10px;
        right: 10px;
      }

      .chatbot-box {
        width: calc(100vw - 20px);
        height: 450px;
        right: 10px;
      }

      .chatbot-toggle {
        width: 55px;
        height: 55px;
      }

      .chat-icon {
        font-size: 24px;
      }

      .message-content {
        max-width: 200px;
      }
    }
  </style>
</head>
<body>

  <!-- Background Image -->
  <div class="background"></div>

  <!-- Header with Logo and Toggle -->
  <header>
    <div class="header-left">
      <img src="/images/logo.jpg.jpeg" alt="Logo" />
    </div>
    <h1>ğŸ“ DSATM Portal - Home</h1>
    <div class="menu-toggle" id="menu-toggle">&#9776;</div>
  </header>

    <!-- Navigation Menu -->
<nav id="nav-menu">
  <a href="home.html">Home</a>
  <a href="main.html">Login</a>
  <a href="timetable.html">Class Timetable</a>
  <a href="exams.html">Exam Schedule</a>
  <a href="leave.html">Leave Application</a>
  
  <a href="grievance.html">Grievance</a>
  
  <a href="assignments.html">Assignments</a>
  <a href="attendance.html">Attendance</a>
</nav>

  <!-- Welcome Box -->
  <section class="welcome">
    <h2>Welcome, Deeksha R ğŸ“</h2>
    <p>
      You are now logged into the DSATM Academic Portal. Here, you can access your class timetables, exam schedules, and attendance records.
      Submit leave applications, track leave history, and raise grievances if needed. Check assignments and manage your academic tasks efficiently, all in one place.
    </p>
  </section>

  <!-- Footer -->
  <footer>
    &copy; 2025 DSATM Student Portal | All rights reserved.
  </footer>

  <!-- Universal Menu Toggle Script -->
  <script src="menu-toggle.js"></script>
  
  <!-- Background zoom follow -->
  <script>
    document.addEventListener("mousemove", (e) => {
      const bg = document.querySelector(".background");
      if (bg) {
        const x = (e.clientX / window.innerWidth) * 100;
        const y = (e.clientY / window.innerHeight) * 100;
        bg.style.backgroundPosition = `${x}% ${y}%`;
      }
    });
  </script>

<!-- Enhanced Chatbot UI -->
<div id="chatbot-container" class="chatbot-container">
  <div id="chatbot-box" class="chatbot-box">
    <div class="chatbot-header">
      <div class="chatbot-title">
        <div class="bot-avatar">ğŸ¤–</div>
        <div>
          <h4>DSATM Assistant</h4>
          <span class="status-indicator">â— Online</span>
        </div>
      </div>
      <button class="close-btn" onclick="toggleChat()">Ã—</button>
    </div>
    <div id="chat-messages" class="chat-messages">
      <div class="welcome-message">
        <div class="bot-message">
          <div class="bot-avatar-small">ğŸ¤–</div>
          <div class="message-content">
            <p>Hi! I'm your DSATM Assistant. I can help you with:</p>
            <ul>
              <li>ğŸ“… Exam schedules</li>
              <li>ğŸ“š Class timetables</li>
              <li>ğŸ“ Assignments</li>
              <li>ğŸ“Š Attendance info</li>
              <li>ğŸ’° Fee details</li>
              <li>ğŸ“– Library services</li>
            </ul>
            <p>How can I assist you today?</p>
          </div>
        </div>
      </div>
    </div>
    <div class="typing-indicator" id="typing-indicator" style="display: none;">
      <div class="bot-avatar-small">ğŸ¤–</div>
      <div class="typing-dots">
        <span></span><span></span><span></span>
      </div>
    </div>
    <div class="chat-controls">
      <div class="control-buttons">
        <button class="control-btn" onclick="chatbot.showHistory()" title="Chat History">ğŸ“œ</button>
        <button class="control-btn" onclick="chatbot.clearChat()" title="Clear Chat">ğŸ—‘ï¸</button>
        <button class="control-btn" onclick="chatbot.toggleQuickOptions()" title="Quick Options">âš™ï¸</button>
      </div>
    </div>
    <div class="quick-options" id="quick-options" style="display: none;">
      <div class="quick-option-grid">
        <button class="quick-btn" onclick="chatbot.quickQuery('exam dates')">
          <span class="quick-number">1</span>
          <span class="quick-text">ğŸ“… Exams</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('attendance')">
          <span class="quick-number">2</span>
          <span class="quick-text">ğŸ“Š Attendance</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('assignments')">
          <span class="quick-number">3</span>
          <span class="quick-text">ğŸ“ Assignments</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('class schedule')">
          <span class="quick-number">4</span>
          <span class="quick-text">ğŸ“š Classes</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('fees')">
          <span class="quick-number">5</span>
          <span class="quick-text">ğŸ’° Fees</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('library')">
          <span class="quick-number">6</span>
          <span class="quick-text">ğŸ“– Library</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('leave application')">
          <span class="quick-number">7</span>
          <span class="quick-text">ğŸ“„ Leave</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('hostel')">
          <span class="quick-number">8</span>
          <span class="quick-text">ğŸ  Hostel</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('help')">
          <span class="quick-number">9</span>
          <span class="quick-text">ğŸ†˜ Help</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('app issues')">
          <span class="quick-number">10</span>
          <span class="quick-text">ğŸ”§ Issues</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('contact support')">
          <span class="quick-number">11</span>
          <span class="quick-text">ğŸ“ Support</span>
        </button>
        <button class="quick-btn" onclick="chatbot.quickQuery('hello')">
          <span class="quick-number">12</span>
          <span class="quick-text">ğŸ‘‹ Greet</span>
        </button>
      </div>
    </div>
    <div class="chat-input-container">
      <input type="text" id="chat-input" placeholder="Ask me anything about DSATM..." />
      <button id="send-btn" onclick="sendMessage()">ğŸ“¤</button>
    </div>
  </div>
  <div class="chatbot-toggle" onclick="toggleChat()">
    <span class="chat-icon">ğŸ’¬</span>
    <div class="notification-badge" id="notification-badge">1</div>
  </div>
</div>
<script>
// Enhanced Chatbot with comprehensive responses
class DSATMChatbot {
  constructor() {
    this.isOpen = false;
    this.messageHistory = [];
    this.init();
  }

  // Comprehensive knowledge base with troubleshooting
  responses = {
    // App issues and troubleshooting
    appissues: {
      patterns: ['app issues', 'app not working', 'problem', 'error', 'bug', 'crash', 'broken', 'not loading', 'slow'],
      response: `ğŸ”§ <strong>App Troubleshooting:</strong><br>
        ğŸ”„ Try refreshing the page (Ctrl+F5)<br>
        ğŸŒ Check your internet connection<br>
        ğŸ“± Clear browser cache and cookies<br>
        ğŸš« Disable browser extensions<br>
        ğŸ”„ Restart your browser<br><br>
        ğŸ“ <em>Still having issues? Contact IT support: 080-1234-5678</em>`
    },

    // Support and contact
    support: {
      patterns: ['contact support', 'help desk', 'technical support', 'it support', 'contact', 'phone number'],
      response: `ğŸ“ <strong>Contact Support:</strong><br>
        ğŸ“ IT Helpdesk: 080-1234-5678<br>
        ğŸ“§ Email: support@dsatm.edu.in<br>
        ğŸ•°ï¸ Hours: 9 AM - 6 PM (Mon-Fri)<br>
        ğŸ¢ Location: IT Office, Ground Floor<br><br>
        ğŸ’¬ <em>For urgent issues, call the helpdesk directly!</em>`
    },

    // Exam-related queries
    exam: {
      patterns: ['exam', 'test', 'examination', 'exam date', 'exam schedule', 'exam time'],
      response: `ğŸ“… <strong>Exam Schedule 2025:</strong><br>
        ğŸ“š Semester 1: August 10-20, 2025<br>
        ğŸ“š Semester 2: September 5-15, 2025<br>
        ğŸ“š Semester 3: October 1-10, 2025<br>
        ğŸ“š Semester 4: November 15-25, 2025<br><br>
        ğŸ’¡ <em>Tip: Register for exams at least 15 days before the exam date!</em>`
    },

    // Class & Schedule queries
    class: {
      patterns: ['class', 'schedule', 'timetable', 'lecture', 'period', 'timing'],
      response: `ğŸ“š <strong>Today's Class Updates:</strong><br>
        ğŸ”„ DSA class: 10 AM â†’ 2 PM (Room 204)<br>
        âŒ AI Lab: Cancelled<br>
        âœ… Web Development: 3 PM (Lab 1)<br><br>
        ğŸ“– <strong>Tomorrow's Schedule:</strong><br>
        âœ… Database Systems: 9 AM (Room 101)<br>
        âœ… Computer Networks: 11 AM (Room 202)`
    },

    // Attendance queries
    attendance: {
      patterns: ['attendance', 'present', 'absent', 'attendance percentage', 'bunked'],
      response: `ğŸ“Š <strong>Your Attendance Status:</strong><br>
        âœ… Overall: 85% (Good standing)<br>
        ğŸ“š DSA: 90% (Excellent)<br>
        ğŸ’» Web Dev: 82% (Good)<br>
        ğŸ—„ï¸ DBMS: 88% (Very Good)<br><br>
        âš ï¸ <em>Minimum 75% required for exam eligibility</em>`
    },

    // Assignment queries
    assignment: {
      patterns: ['assignment', 'homework', 'project', 'submission', 'deadline', 'due'],
      response: `ğŸ“ <strong>Pending Assignments:</strong><br>
        ğŸ”´ DSA Lab Report - Due: Tomorrow<br>
        ğŸŸ¡ Web Development Project - Due: Jan 15<br>
        ğŸŸ¢ Database Design - Due: Jan 20<br><br>
        ğŸ“¤ <em>Submit through the assignments portal</em>`
    },

    // Fee queries
    fees: {
      patterns: ['fee', 'fees', 'payment', 'tuition', 'cost', 'money', 'pay'],
      response: `ğŸ’° <strong>Fee Information:</strong><br>
        ğŸ’³ Semester Fee: â‚¹45,000<br>
        ğŸ“Š Paid: â‚¹30,000<br>
        ğŸ”´ Pending: â‚¹15,000<br>
        ğŸ“… Due Date: January 31, 2025<br><br>
        ğŸ’¡ <em>Pay online or visit the accounts section</em>`
    },

    // Library queries
    library: {
      patterns: ['library', 'book', 'borrow', 'return', 'library hours', 'books'],
      response: `ğŸ“– <strong>Library Services:</strong><br>
        ğŸ• Hours: 8 AM - 8 PM (Mon-Sat)<br>
        ğŸ“š Books Issued: 2 (Max: 5)<br>
        ğŸ“… Return Due: Jan 18, 2025<br>
        ğŸ’» E-Resources: Available 24/7<br><br>
        ğŸ“± <em>Use library app for renewals</em>`
    },

    // Leave & Grievance queries
    leave: {
      patterns: ['leave', 'absent', 'sick leave', 'holiday', 'grievance', 'complaint'],
      response: `ğŸ“„ <strong>Leave & Grievance:</strong><br>
        ğŸ“ Leave Applications: 2 pending<br>
        âœ… Medical Leave: 5 days approved<br>
        ğŸ“‹ Grievance Status: Under review<br><br>
        ğŸ’¡ <em>Check leave portal for updates</em>`
    },

    // Hostel queries
    hostel: {
      patterns: ['hostel', 'mess', 'room', 'accommodation', 'food', 'dining'],
      response: `ğŸ  <strong>Hostel Information:</strong><br>
        ğŸ  Room: Block A-205<br>
        ğŸ½ï¸ Mess Timing: 7-9 AM, 12-2 PM, 7-9 PM<br>
        ğŸœ Today's Menu: Available at mess<br>
        ğŸ”§ Maintenance: Report online<br><br>
        ğŸ“± <em>Download hostel app for services</em>`
    },

    // General help
    help: {
      patterns: ['help', 'what can you do', 'options', 'commands', 'assist'],
      response: `ğŸ¤– <strong>I can help you with:</strong><br>
        ğŸ“… Exam schedules & dates<br>
        ğŸ“š Class timetables & changes<br>
        ğŸ“Š Attendance tracking<br>
        ğŸ“ Assignment deadlines<br>
        ğŸ’° Fee information<br>
        ğŸ“– Library services<br>
        ğŸ  Hostel information<br>
        ğŸ“„ Leave applications<br><br>
        ğŸ’¬ <em>Just ask me anything!</em>`
    },

    // Greeting responses
    greeting: {
      patterns: ['hi', 'hello', 'hey', 'good morning', 'good afternoon', 'good evening'],
      response: `ğŸ‘‹ <strong>Hello there!</strong><br>
        I'm your DSATM Assistant. I'm here to help you with all your academic needs.<br><br>
        ğŸ¯ <em>Try asking about exams, classes, attendance, or assignments!</em>`
    }
  };

  init() {
    this.bindEvents();
    this.hideNotification();
  }

  bindEvents() {
    const input = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.sendMessage();
      }
    });

    sendBtn.addEventListener('click', () => this.sendMessage());
  }

  toggleChat() {
    const chatbox = document.getElementById('chatbot-box');
    this.isOpen = !this.isOpen;
    
    if (this.isOpen) {
      chatbox.classList.add('open');
      this.hideNotification();
      document.getElementById('chat-input').focus();
      // Ensure proper scroll functionality
      setTimeout(() => this.scrollToBottom(), 100);
    } else {
      chatbox.classList.remove('open');
    }
  }

  sendMessage() {
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    
    if (!message) return;

    this.addUserMessage(message);
    input.value = '';
    
    this.showTypingIndicator();
    
    setTimeout(() => {
      this.hideTypingIndicator();
      this.processMessage(message);
    }, 1000 + Math.random() * 1000); // Random delay for realism
  }

  addUserMessage(message) {
    const messagesContainer = document.getElementById('chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'user-message';
    messageDiv.innerHTML = `
      <div class="user-avatar">ğŸ‘¤</div>
      <div class="message-content">
        <p>${message}</p>
      </div>
    `;
    messagesContainer.appendChild(messageDiv);
    this.scrollToBottom();
  }

  addBotMessage(message) {
    const messagesContainer = document.getElementById('chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'bot-message';
    messageDiv.innerHTML = `
      <div class="bot-avatar-small">ğŸ¤–</div>
      <div class="message-content">
        ${message}
      </div>
    `;
    messagesContainer.appendChild(messageDiv);
    this.scrollToBottom();
  }

  processMessage(message) {
    const lowerMessage = message.toLowerCase();
    let response = this.getDefaultResponse();
    
    // Find matching response
    for (const [category, data] of Object.entries(this.responses)) {
      if (data.patterns.some(pattern => lowerMessage.includes(pattern))) {
        response = data.response;
        break;
      }
    }
    
    this.addBotMessage(response);
  }

  getDefaultResponse() {
    const defaultResponses = [
      `ğŸ¤” I'm not sure about that. Try asking about:<br>
       ğŸ“… Exams â€¢ ğŸ“š Classes â€¢ ğŸ“Š Attendance â€¢ ğŸ“ Assignments<br>
       ğŸ’° Fees â€¢ ğŸ“– Library â€¢ ğŸ  Hostel â€¢ ğŸ“„ Leave`,
      
      `â“ Could you rephrase that? I can help with:<br>
       ğŸ¯ Academic schedules and deadlines<br>
       ğŸ“‹ Student services and information<br>
       ğŸ’¡ Type "help" to see all my capabilities!`,
       
      `ğŸ” I didn't quite understand. Popular queries:<br>
       "What are my exam dates?"<br>
       "Show my attendance"<br>
       "Any class changes today?"`
    ];
    
    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
  }

  showTypingIndicator() {
    document.getElementById('typing-indicator').style.display = 'flex';
    this.scrollToBottom();
  }

  hideTypingIndicator() {
    document.getElementById('typing-indicator').style.display = 'none';
  }

  scrollToBottom() {
    const messagesContainer = document.getElementById('chat-messages');
    setTimeout(() => {
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 100);
  }

  hideNotification() {
    const badge = document.getElementById('notification-badge');
    if (this.isOpen) {
      badge.style.display = 'none';
    }
  }

  // Save conversation to history
  saveToHistory(userMessage, botResponse) {
    const conversation = {
      timestamp: new Date(),
      user: userMessage,
      bot: botResponse
    };
    this.messageHistory.push(conversation);
    
    // Keep only last 20 conversations
    if (this.messageHistory.length > 20) {
      this.messageHistory = this.messageHistory.slice(-20);
    }
    
    // Save to localStorage
    localStorage.setItem('dsatm_chat_history', JSON.stringify(this.messageHistory));
  }

  // Load history from localStorage
  loadHistory() {
    const saved = localStorage.getItem('dsatm_chat_history');
    if (saved) {
      this.messageHistory = JSON.parse(saved);
    }
  }

  // Show chat history modal
  showHistory() {
    this.loadHistory();
    
    if (this.messageHistory.length === 0) {
      this.addBotMessage('ğŸ“œ <strong>No chat history found!</strong><br>Start a conversation to see your chat history here.');
      return;
    }

    const modal = document.createElement('div');
    modal.className = 'history-modal';
    modal.innerHTML = `
      <div class="history-content">
        <div class="history-header">
          <h3>ğŸ“œ Chat History</h3>
          <button class="history-close" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
        </div>
        <div class="history-list">
          ${this.messageHistory.map(item => `
            <div class="history-item">
              <div class="history-timestamp">${new Date(item.timestamp).toLocaleString()}</div>
              <div class="history-messages">
                <strong>You:</strong> ${item.user}<br>
                <strong>Bot:</strong> ${item.bot.replace(/<[^>]*>/g, '').substring(0, 100)}...
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
  }

  // Clear chat messages
  clearChat() {
    const messagesContainer = document.getElementById('chat-messages');
    messagesContainer.innerHTML = `
      <div class="welcome-message">
        <div class="bot-message">
          <div class="bot-avatar-small">ğŸ¤–</div>
          <div class="message-content">
            <p>âœ¨ Chat cleared! How can I help you today?</p>
          </div>
        </div>
      </div>
    `;
    
    // Also clear history
    this.messageHistory = [];
    localStorage.removeItem('dsatm_chat_history');
  }

  // Toggle quick options
  toggleQuickOptions() {
    const quickOptions = document.getElementById('quick-options');
    quickOptions.style.display = quickOptions.style.display === 'none' ? 'block' : 'none';
  }

  // Handle quick query buttons
  quickQuery(query) {
    const input = document.getElementById('chat-input');
    input.value = query;
    this.sendMessage();
    
    // Hide quick options after selection
    document.getElementById('quick-options').style.display = 'none';
  }

  // Override processMessage to save to history
  processMessage(message) {
    const lowerMessage = message.toLowerCase();
    let response = this.getDefaultResponse();
    
    // Find matching response
    for (const [category, data] of Object.entries(this.responses)) {
      if (data.patterns.some(pattern => lowerMessage.includes(pattern))) {
        response = data.response;
        break;
      }
    }
    
    this.addBotMessage(response);
    this.saveToHistory(message, response);
  }
}

// Initialize chatbot
const chatbot = new DSATMChatbot();

// Global functions for onclick handlers
function toggleChat() {
  chatbot.toggleChat();
}

function sendMessage() {
  chatbot.sendMessage();
}

// Auto-show notification after page load
setTimeout(() => {
  const badge = document.getElementById('notification-badge');
  if (badge && !chatbot.isOpen) {
    badge.style.display = 'flex';
    badge.textContent = '!';
  }
}, 3000);
</script>

</body>
</html>
